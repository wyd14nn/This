<!DOCTYPE html>
<html>
<head>
    <title>The Station - Chapter 1</title>
    <style>
        /* This makes the game fill the whole browser window */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #050508; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        #game-container { 
            position: relative; 
            width: 100vw; /* 100% of Viewport Width */
            height: 100vh; /* 100% of Viewport Height */
            overflow: hidden; 
            cursor: pointer; 
        }

        canvas { 
            display: block; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; /* Keeps it from stretching weirdly */
            image-rendering: pixelated; 
        }

        #overlay { position: absolute; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; transition: opacity 2s; color: #a9b1d6; font-family: 'Courier New', monospace; }

        #dialogue-box { 
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); 
            width: 80%; max-width: 600px; background: rgba(10, 10, 15, 0.9); 
            border-left: 4px solid #7aa2f7; padding: 20px; color: #a9b1d6; 
            font-family: 'Courier New', monospace; font-size: 16px; pointer-events: none; 
        }
    </style>
</head>
<body>

<div id="game-container" onclick="startGame()">
    <div id="overlay"><h1>HOW WE REMEMBER</h1><p>Click to step into the rain</p></div>
    <canvas id="gameCanvas"></canvas>
    <div id="dialogue-box"></div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const diagBox = document.getElementById('dialogue-box');

    // Resize canvas to match window
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    let gameStarted = false;
    let player = { x: 0, y: 0, w: 64, h: 64, speed: 5 };
    let keys = {};

    // IMAGES
    const bg = new Image();
    bg.src = 'https://img.itch.zone/aW1nLzI5MzkyOTYucG5n/original/L0vOn4.png'; 

    const sprite = new Image();
    sprite.src = 'https://i.imgur.com/7S8uA0m.png'; // Small pixel character

    function startGame() {
        if (!gameStarted) {
            document.getElementById('overlay').style.opacity = "0";
            setTimeout(() => document.getElementById('overlay').style.display = "none", 2000);
            gameStarted = true;
            typeWriter("The train station hasn't changed... but I have.");
        }
    }

    let targetText = ""; let currentText = ""; let charIndex = 0;
    function typeWriter(text) {
        if (targetText === text) return;
        targetText = text; currentText = ""; charIndex = 0;
        flow();
    }
    function flow() {
        if (charIndex < targetText.length) {
            currentText += targetText.charAt(charIndex);
            diagBox.innerHTML = currentText;
            charIndex++; setTimeout(flow, 40);
        }
    }

    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    function draw() {
        if (!gameStarted) { requestAnimationFrame(draw); return; }

        ctx.fillStyle = "#1a1b26";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Ground level based on screen height
        let groundY = canvas.height * 0.75;
        player.y = groundY - player.h;

        // Background (Parallax)
        let bgWidth = canvas.height * (800/400); // Maintain aspect ratio
        let bgX = -(player.x * 0.5) % bgWidth;
        ctx.drawImage(bg, bgX, 0, bgWidth, canvas.height);
        ctx.drawImage(bg, bgX + bgWidth, 0, bgWidth, canvas.height);

        if (keys['ArrowRight']) player.x += player.speed;
        if (keys['ArrowLeft']) player.x -= player.speed;

        // Draw Player Sprite
        ctx.drawImage(sprite, canvas.width/2 - player.w/2, player.y, player.w, player.h);

        // Rain
        ctx.strokeStyle = "rgba(255,255,255,0.1)";
        for(let i=0; i<30; i++) {
            let rx = Math.random() * canvas.width;
            let ry = Math.random() * canvas.height;
            ctx.beginPath(); ctx.moveTo(rx, ry); ctx.lineTo(rx-1, ry+15); ctx.stroke();
        }

        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
